<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Benchmarking Joomla</title>
  <meta name="description" content=""Tell my wife I love her very much, she knows"
" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://fernandoipar.com/mysql/2014/10/31/benchmarking-joomla.html">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://fernandoipar.com" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/df_logo.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Benchmarking Joomla</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.png)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Fernando Ipar</h4>
              on
              <time datetime="2014-10-31T11:16:45-05:00">31 Oct 2014</time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p><a href="https://mariadb.com/blog/why-i-moved-my-joomla-website-mariadb">This post</a> recently caught my attention on Planet MySQL.</p>

<p>If you haven't read it yet, I suggest that you go and do so, and also read the comments.</p>

<p>I think Matthew's request for the queries so that others can run comparative benchmarks is very interesting, and while I don't have access to the queries used to produce those results, I am making some queries of my own available for others to test. You can get your own queries if you want, just enable slow query logging with long_query_time set to 0 on the database for a Joomla instalation (being unexperienced in Joomla I used <a href="https://github.com/joomlatools/joomla-vagrant">this project</a>, which is great) and then run these steps on the resulting slow query log file:</p>

<p><code><br />
csplit -z joomlatools-slow.log '/^#/' '{*}'<br />
for f in x*; do grep -i select $f &gt;/dev/null || rm -f $f; done<br />
for f in x*; do grep -v '^SET' $f &gt; $$ &amp;&amp; mv -f $$ $f; done<br />
for f in x*; do grep -v '^#' $f &gt; $$ &amp;&amp; mv -f $$ $f; done<br />
for f in x*; do tr '\n' ' ' &lt;$f&gt;$$ &amp;&amp; echo &gt;&gt; $$ &amp;&amp; mv -f $$ $f; done<br />
cat x* &gt; queries.txt<br />
</code></p>

<p>That should give you a file similar to <a href="https://gist.github.com/fipar/3bf5b48685e89e7199f3">this one.</a><br />
The EXPLAIN statements are not mine, everything you see on that file was generated by me visiting a sample Joomla site. </p>

<p>I do not have the time to run a big benchmark now, but a mysqlslap using the exact same settings as those from the original post, and my list of queries, seems simple enough. </p>

<p>The vagrant box for Joomla has MySQL 5.5 so I used that for my tests. Here are the results: </p>

<p>MySQL 5.5 with the default configuration (default as installed by the debian package):<br />
<code><br />
root@joomlatools:~# mysqlslap --concurrency=100 --iterations=10 --query=queries.txt --create-schema=myuser_joomla -umyuser_joom -p7654e684c4d14ab544261568101cc9c4<br />
Benchmark<br />
    Average number of seconds to run all queries: 1.911 seconds<br />
    Minimum number of seconds to run all queries: 1.786 seconds<br />
    Maximum number of seconds to run all queries: 2.202 seconds<br />
    Number of clients running queries: 100<br />
    Average number of queries per client: 265<br />
</code></p>

<p>MariaDB 10.1, with the config as installed by the MariaDB package:<br />
<code><br />
root@joomlatools:~# mysqlslap --concurrency=100 --iterations=10 --query=queries.txt --create-schema=myuser_joomla -umyuser_joom -p7654e684c4d14ab544261568101cc9c4<br />
Benchmark<br />
    Average number of seconds to run all queries: 1.743 seconds<br />
    Minimum number of seconds to run all queries: 1.694 seconds<br />
    Maximum number of seconds to run all queries: 1.847 seconds<br />
    Number of clients running queries: 100<br />
    Average number of queries per client: 265<br />
</code></p>

<p>MySQL 5.5 with MariaDB's configuration (minus incompatible options)<br />
<code><br />
root@joomlatools:~# mysqlslap --concurrency=100 --iterations=10 --query=queries.txt --create-schema=myuser_joomla -umyuser_joom -p7654e684c4d14ab544261568101cc9c4<br />
Benchmark<br />
    Average number of seconds to run all queries: 1.803 seconds<br />
    Minimum number of seconds to run all queries: 1.548 seconds<br />
    Maximum number of seconds to run all queries: 2.398 seconds<br />
    Number of clients running queries: 100<br />
    Average number of queries per client: 265<br />
</code></p>

<p>Interesting. MariaDB still performs better than 5.5, but performance improved for this old version anyway.<br />
I took a quick look at the configuration file and among the changes, use of the query cache caught my attention. I think it's strange to have it enabled by default since it can cause so much contention problems at heavy concurrency workloads, but I'm not familiar with the MariaDB improvements and perhaps the query cache implementation on it is better at scaling. </p>

<p>Just to check, I tried MariaDB 10.1 with the query cache disabled:<br />
<code><br />
mariadb 10.1 without the query cache:<br />
root@joomlatools:~# mysqlslap --concurrency=100 --iterations=10 --query=queries.txt --create-schema=myuser_joomla -umyuser_joom -p7654e684c4d14ab544261568101cc9c4<br />
Benchmark<br />
    Average number of seconds to run all queries: 4.113 seconds<br />
    Minimum number of seconds to run all queries: 3.735 seconds<br />
    Maximum number of seconds to run all queries: 5.446 seconds<br />
    Number of clients running queries: 100<br />
    Average number of queries per client: 265<br />
</code></p>

<p>Interesting. It seems without the query cache, MariaDB 10.1 performs worse than MySQL 5.5. Could be a concurrency thing though, as I know more recent MySQL versions (and I assume the same is true for MariaDB) have worked on optimising for high concurrency use cases, at the expense of low concurrency or single threaded workloads. And while the mysqlslap invocation runs 100 threads, don't be fooled. I ran this on a VM on a notebook with 2 cores with hyperthreading. It's great as a workstation but it wouldn't cut it as a server :)</p>

<p>I'd like to see what experience others have. You know exactly the VM and workload I used for this tests, so let's see what numbers you get. </p>

        </section>
<!-- fi-posts -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'fipar';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a
    href="https://disqus.com/?ref_noscript" rel="nofollow">comments
    powered by Disqus.</a></noscript>
        <footer class="post-footer">
          <section class="share">
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.png)">Blog Logo</div>
              <h4>Fernando Ipar</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2014-10-31 11:16">31 Oct 2014</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Fernando Ipar</a> &copy; 2019<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/vivi_papas.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Fernando Ipar</h1>
        <h2 class="blog-description">"Tell my wife I love her very much, she knows"
</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>


  </body>
</html>
